# CI/CD 最佳实践

## CI/CD 有哪些最佳实践？

1. **只构建一次**：不要为每个阶段创建一个新构建，这会带来不一致风险。在 CI/CD 流水线中，推荐使用同一个构建制品（与环境无关的构建）；
2. 简化测试：在测试覆盖率和性能之间取得平衡。如果花费很长时间才能出现测试结果，用户则会试图绕开这些流程；
3. 快速失败：在 CI 侧，提交代码的研发人员需要尽快得知他们提交的代码是否有问题，以便还能在熟悉这些代码的时候快速回滚和修复。“快速失败” 理念帮助开发人员减少上下文切换，让 DevOps 专业人员更加快乐；
4. 每天提交：代码提交越规律，DevOps 团队将能看到越多价值；
5. 有问题就修复：CI/CD 让修复失败构建变得更加简单；
6. 清空预生产环境：环境持续运行时间越长，越难追踪应用在环境上的配置变更和更新。在每次部署之间都清空预生产环境是好习惯；
7. 始终自动化：不断调整 CI/CD 流水线以确保实现持持续自动化；
8. 明确步骤：确保版本发布和回滚计划明确写进文档，并被整个团队理解；
9. 保持安全：CI/CD 是一种左移，因此它提供了一个很好的机会，将安全集成到早期流程中；
10. 反馈循环：确保整个团队有一个简单办法来接受（或者贡献）反馈。

## 深入研究 CD 的最佳实践

CD（持续交付/部署）也值得深入研究一下它们的最佳实践，尽管风头总是被 CI 抢走了。以下是 CD 的最佳实践：

- 立即开始：不要等新平台，从现有的开始调整，让它们变得更快、更高效；
- 少即是多：最好的 CD 是用最少的工具完成的；
- 追踪正在发生的事情：Issue 和 Merge Request 可能会失控，但 Milestone 可以提供帮助的，例如在设置敏捷冲刺和发布时，Milestone 具有双重作用：帮助跟踪正在进行的所有事项；进行有计划的交付；
- 自动化部署变更：通过自动化简化用户验收测试和 staging 环境部署；
- 管理发布流水线：自动化一切；
- 建立监控：密切关注生产流程能够节约时间和金钱,还能够对业务侧提供关键数据；
- 启动持续部署：一旦启动持续交付，就把手从部署上拿开，通过自动化将变更部署到生产环境。

## Resources

- https://gitlab.cn/resources/articles/e733c0e9-b684-4419-a9c7-271caa93b298
